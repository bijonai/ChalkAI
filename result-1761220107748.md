好的，這是一份為數字互動課堂設計的二叉樹算法高階課程計劃。該計劃側重於內容和教學流程，逐步引導學生掌握核心概念。

---
step: 1
conditional: false
---

### 歡迎來到二叉樹的世界！

你好！歡迎學習數據結構中最重要的概念之一：**二叉樹**。

你可能會想，什麼是二叉樹？為什麼要學習它？

簡單來說，二叉樹是一種像真實樹木一樣有“根”有“分支”的數據結構，但它在計算機科學中被用來高效地組織和搜索數據。從文件系統到數據庫索引，再到你的路由器，二叉樹無處不在！

在這個課程中，我們將從零開始，一步步探索二叉樹的奧秘。準備好了嗎？讓我們開始吧！

- **視覺元素**：顯示一張概念圖，左邊是一棵真實的樹，右邊是一張倒置的、抽象的二叉樹結構圖，兩者之間有一個箭頭，表示“抽象化”。

---
step: 2
conditional: false
---

### 什麼是節點 (Node)？

在我們構建一棵完整的樹之前，需要先了解它的基本組成部分：**節點 (Node)**。

一個節點可以看作是一個包含三樣東西的容器：
1.  **數據 (Data)**：節點存儲的實際值，例如數字 `10`。
2.  **左子節點指針 (Left Child)**：指向另一節點，這個節點的值必須小於當前節點（如果是二叉搜索樹）。
3.  **右子節點指針 (Right Child)**：指向另一節點，這個節點的值必須大於當前節點（如果是二叉搜索樹）。

如果一個節點沒有左子節點或右子節點，它的對應指針就指向 `空 (null)`。

- **佈局**：使用左右兩欄佈局。
- **左欄內容**：
    - 顯示標題“節點結構”。
    - 展示一個節點的`C`語言結構體代碼示例：
    ```c
    struct TreeNode {
        int data; // 數據
        struct TreeNode* left; // 指向左子節點
        struct TreeNode* right; // 指向右子節點
    };
    ```
- **右欄內容**：
    - **視覺元素**：顯示一個單獨的、放大的節點圖。節點中間有一個數字（例如 `50`），並且有兩條箭頭分別標記為 `left` 和 `right`，指向兩個標有 "null" 的方框。

---
step: 3
conditional: true
---

### 親手搭建你的第一棵樹

現在，讓我們來熟悉一些基本術语，並親手搭建一棵小樹！

- **根節點 (Root)**：一棵樹最頂端的節點。
- **父節點 (Parent)**：擁有子節點的節點。
- **子節點 (Child)**：被父節點指向的節點。
- **葉節點 (Leaf)**：沒有任何子節點的節點。

**你的任務**：拖動下方的節點，將它們連接起來，構建一棵有效的二叉樹。將 `50` 作為根節點。

- **互動元素**：
    - **畫布 (Canvas)**：頂部有一個標記為“Root”的空位。
    - **節點池**：畫布下方提供幾個可以拖動的節點，節點上標有數字，例如 `50`, `30`, `70`, `20`。
    - **互動邏輯**：
        1. 學生首先需要將 `50` 拖動到 “Root” 位置。
        2. 然後，他們可以拖動其他節點。當一個節點（如 `30`）靠近 `50` 的左下方時，會出現一條連接線，鬆開鼠標後，`30` 會成為 `50` 的左子節點。同樣，`70` 可以被連接為右子節點。
        3. 學生需要將所有節點都連接到樹上。

**完成條件**：學生成功將所有提供的節點組合成一棵樹（任何有效的結構都可以，此時還不要求是二叉搜索樹），並點擊“完成”按鈕。

---
step: 4
conditional: true
---

### 知識測驗：基本術語

做得好！現在你已經有了一棵自己搭建的樹。讓我們來測試一下你是否理解了剛才的術語。

請根據下圖回答問題：

- **視覺元素**：顯示一棵固定的二叉樹圖。
    - Root: 15
    - Left child of 15: 7
    - Right child of 15: 25
    - Left child of 7: 4
    - Right child of 7: 10
    - Left child of 25: 20
    - Right child of 25: 30
    - 節點 4, 10, 20, 30 是葉節點。

**問題1**: 這棵樹的根節點是什麼？
- **表單元素**：一個輸入框。

**問題2**: 節點 `7` 的父節點是什麼？
- **表單元素**：一個輸入框。

**問題3**: 請選擇所有的葉節點。
- **表單元素**：多選題 (Chooser)，選項為樹中的所有節點 `15, 7, 25, 4, 10, 20, 30`。

**完成條件**：學生必須正確回答所有三個問題。答錯時會給予提示（例如，“再想想，根節點是樹最頂端的那個！”）。

---
step: 5
conditional: false
---

### 二叉樹的分類

二叉樹有很多種，就像現實世界中的樹木有松樹、柳樹一樣。了解它們的分類有助於我們選擇合適的工具來解決問題。

這裡介紹幾種常見的二叉樹：

- **分頁器 (Paginator)**：使用標簽頁來分別展示不同種類的二叉樹。

  - **標簽1: 滿二叉樹 (Full Binary Tree)**
    - **內容**: 一棵深度為 `k` 且擁有 `2^k - 1` 個節點的二叉樹。它的每一層都完全填滿了節點。非常“完美”和對稱。
    - **視覺元素**: 展示一棵高度為3的滿二叉樹。

  - **標簽2: 完全二叉樹 (Complete Binary Tree)**
    - **內容**: 除了最後一層，其他各層都被完全填滿，且最後一層的所有節點都盡可能地靠左排列。
    - **視覺元素**: 展示一棵完全二叉樹。旁邊再放一棵非完全二叉樹作為對比（例如，最後一層的節點分佈不連續）。

  - **標簽3: 二叉搜索樹 (Binary Search Tree - BST)**
    - **內容**: 這是一種非常重要的樹！它有著特殊的規則：
        1.  任意節點的左子樹中所有節點的值，都**小於**該節點的值。
        2.  任意節點的右子樹中所有節點的值，都**大於**該節點的值。
        3.  它的左右子樹也分別是二叉搜索樹。
        這個特性使得查找操作非常高效！
    - **視覺元素**: 展示一棵符合BST規則的樹，並用顏色或標籤突出顯示大小關係（例如，根是`50`，左邊是`30`，右邊是`70`）。

---
step: 6
conditional: true
---

### 互動練習：二叉搜索樹 (BST)

現在你來扮演一次“數據排序大師”！

**你的任務**：將數字 `45` 插入到下面的二叉搜索樹中正確的位置。

- **互動元素**：
    - **畫布(Canvas)**：顯示一棵預設的二叉搜索樹（例如，根為`50`，包含`30`, `70`, `20`, `80`等節點）。
    - **可拖動的節點**：一個標有數字 `45` 的節點。
    - **互動邏輯**：
        1. 學生需要將 `45` 這個節點拖動到畫布上。
        2. 當 `45` 懸停在一個節點上時（例如根節點`50`），系統會提示：“`45` 小於 `50`，應該去左邊”。
        3. 學生繼續將 `45` 拖到節點 `30` 附近，系統提示：“`45` 大於 `30`，應該去右邊”。
        4. 最終，`45` 會被放置在 `30` 的右子節點位置，這個位置是空的。當學生將其拖放到正確位置時，節點會自動吸附並連接好。

**完成條件**：學生將數字 `45` 成功放置在正確的位置。

---
step: 7
conditional: false
---

### 核心操作：二叉樹的遍歷

“遍歷” (Traversal) 是指按照某種順序，不重不漏地訪問樹中的每一個節點。這是二叉樹最基本、最重要的操作。

想像一下你在遊覽一個迷宮，遍歷就是你系統性地走遍每一條路徑，確保不錯過任何一個角落的方法。

我們主要學習四種遍歷方式：
1.  **前序遍歷 (Pre-order)**
2.  **中序遍歷 (In-order)**
3.  **後序遍歷 (Post-order)**
4.  **層序遍歷 (Level-order)**

接下來，我們將通過動畫來逐一學習它們。

- **視覺元素**：顯示一棵我們將在接下來幾個步驟中使用的示例樹。在旁邊標註：“記住這棵樹，我們將用它來演示所有遍歷方法。”
    - Tree Example: Root: F, Children: B, G. B's Children: A, D. D's Children: C, E. G's Child: I. I's Child: H.

---
step: 8
conditional: true
---

### 遍歷一：前序遍歷 (根 -> 左 -> 右)

**規則**：對於任何子樹，始終遵循 **根節點 -> 左子樹 -> 右子樹** 的順序訪問。

讓我們來看看這個過程是如何運作的。點擊“播放”按鈕觀看動畫。

- **佈局**：分成三列。
- **第一列：規則**
    - 顯示文字：`Pre-order: Root -> Left -> Right`
- **第二列：動畫演示**
    - **視覺元素**：顯示上一步中的示例樹。
    - **互動元素**：一個“播放”按鈕。
    - **動畫邏輯**：點擊播放後，動畫按以下順序高亮節點：`F` -> `B` -> `A` -> `D` -> `C` -> `E` -> `G` -> `I` -> `H`。每當一個節點被訪問時，它會閃爍，並且它的值會被添加到第三列的結果列表中。
- **第三列：遍歷結果**
    - 顯示一個標題“訪問順序:”。
    - 一個列表，隨著動畫的進行，逐個顯示被訪問的節點值。

**問題**：根據前序遍歷規則，走完上面的動畫後，得到的最終順序是什麼？
- **表單元素**：一個輸入框，要求學生輸入以逗號分隔的字符序列（例如 F,B,A,...）。

**完成條件**：學生輸入正確的前序遍歷序列 `F,B,A,D,C,E,G,I,H`（格式可以不嚴格，比如大小寫、空格）。

---
step: 9
conditional: true
---

### 遍歷二：中序遍歷 (左 -> 根 -> 右)

**規則**：對於任何子樹，始終遵循 **左子樹 -> 根節點 -> 右子樹** 的順序。

對於二叉搜索樹 (BST) 而言，中序遍歷的結果將是一個有序的序列！

- **佈局**：與上一步相同的三列佈局。
- **第一列：規則**
    - 顯示文字：`In-order: Left -> Root -> Right`
- **第二列：動畫演示**
    - **視覺元素**：同樣的示例樹。
    - **互動元素**：一個“播放”按鈕。
    - **動畫邏輯**：點擊播放後，動畫按中序遍歷順序高亮節點。`A` -> `B` -> `C` -> `D` -> `E` -> `F` -> `G` -> `H` -> `I`。
- **第三列：遍歷結果**
    - 一個列表，動態顯示訪問順序。

**問題**：這棵樹的中序遍歷序列是什麼？
- **表單元素**：一個輸入框。

**完成條件**：學生輸入正確的中序遍歷序列 `A,B,C,D,E,F,G,H,I`。

---
step: 10
conditional: true
---

### 遍歷三：後序遍歷 (左 -> 右 -> 根)

**規則**：對於任何子樹，始終遵循 **左子樹 -> 右子樹 -> 根節點** 的順序。

這種遍歷方式常用於“先處理子問題，再處理父問題”的場景，例如計算目錄大小（先計算子目錄大小，再匯總）。

- **佈局**：與上一步相同的三列佈局。
- **第一列：規則**
    - 顯示文字：`Post-order: Left -> Right -> Root`
- **第二列：動畫演示**
    - **視覺元素**：同樣的示例樹。
    - **互動元素**：一個“播放”按鈕。
    - **動畫邏輯**：點擊播放後，動畫按後序遍歷順序高亮節點。`A` -> `C` -> `E` -> `D` -> `B` -> `H` -> `I` -> `G` -> `F`。
- **第三列：遍歷結果**
    - 一個列表，動態顯示訪問順序。

**問題**：這棵樹的後序遍歷序列是什麼？
- **表單元素**：一個輸入框。

**完成條件**：學生輸入正確的後序遍歷序列 `A,C,E,D,B,H,I,G,F`。

---
step: 11
conditional: true
---

### 遍歷四：層序遍歷 (逐層遍歷)

**規則**：從上到下，從左到右，逐層訪問所有節點。

這種方式就像我們閱讀書本一樣，一行一行地讀。它通常需要借助一個叫做“隊列”的數據結構來實現。

- **佈局**: 分成兩行。
- **第一行：動畫**
    - **視覺元素**: 示例樹。下方有一個表示隊列的長方形框。
    - **互動**: "播放"按鈕。
    - **動畫邏輯**:
        1. `F`被訪問，並加入隊列。
        2. `F`出隊列，它的子節點`B`和`G`按順序入隊列。
        3. `B`出隊列，它的子節點`A`和`D`入隊列。
        4. `G`出隊列，它的子節點`I`入隊列。
        5. ...以此類推，直到隊列為空。
        - 每次有節點被訪問（出隊列時），它的值都添加到下方的結果列表中。

- **第二行：結果**
    - **遍歷結果**: `F, B, G, A, D, I, C, E, H`

**問題**：如果一棵樹的根節點是1，它的左孩子是2，右孩子是3。節點2的左孩子是4。那麼層序遍歷的結果是什麼？
- **表單元素**: 選擇題 (Chooser)
    - A) 1, 2, 3, 4
    - B) 1, 2, 4, 3
    - C) 4, 2, 1, 3

**完成條件**：學生選擇正確答案 A。

---
step: 12
conditional: false
---

### 二叉搜索樹(BST)的核心操作：插入與刪除

我們已經知道BST的特性了，現在來學習如何維護它。

**插入 (Insertion)**
- 就像我們之前練習的那樣：從根節點開始，如果要插入的值比當前節點小，就往左走；如果大，就往右走。直到找到一個空位，將新節點放在那裡。

**刪除 (Deletion)**
- 刪除操作要複雜一些，需要分三種情況討論：
    1.  **要刪除的節點是葉節點**：直接刪除即可。
    2.  **要刪除的節點只有一個子節點**：讓它的子節點替代它的位置。
    3.  **要刪除的節點有兩個子節點**：這是最複雜的情況。你需要從它的**右子樹**中找到**最小**的節點（或者從左子樹中找到最大的節點），用這個節點的值替換要刪除的節點，然後再刪除那個最小的節點。

接下來的互動練習將幫助你理解這個過程。

---
step: 13
conditional: true
---

### 互動練習：刪除節點

是時候挑戰最難的操作了！

**你的任務**：從下面的BST中刪除值為 **18** 的節點。

- **互動元素**：
    - **畫布 (Canvas)**：顯示一棵BST，其中包含要被刪除的節點`18`，且`18`有兩個子節點（例如，左子`16`，右子`25`）。
    - 整個樹的結構為：`Root: 15`, `Right: 18`, `18's Left: 16`, `18's Right: 25`, `25's Left: 20`, `25's Right: 30`.
    - **引導式問題**：
        1. 首先，系統高亮節點 `18`，並提問：“節點 `18` 有幾個子節點？”
           - **選項**: [0, 1, 2]。學生需選擇 `2`。
        2. 選擇正確後，系統提問：“我們應該用哪個節點的值來替換 `18`？（提示：右子樹中的最小值）”
           - 學生需要點擊樹上正確的節點。在此例中，是節點 `20`。
        3. 點擊正確後，動畫將展示 `18` 的值被 `20` 替換。然後原來的 `20` 節點被高亮，系統提示：“現在，我們只需要刪除這個節點。這是一個簡單的刪除操作。”
        4. 動畫會展示 `20` 節點被移除，它的父節點 `25` 的左指針指向 `null`。

**完成條件**：學生按照引導的步驟完成整個刪除過程，並看到最終的樹形結構。

---
step: 14
conditional: false
---

### 課程總結與展望

恭喜你！你已經完成了二叉樹核心概念的學習！

讓我們快速回顧一下今天學到的內容：
- **基本概念**：節點、根、父、子、葉的定義。
- **主要分類**：滿二叉樹、完全二叉樹和至關重要的**二叉搜索樹 (BST)**。
- **四種遍歷**：前序、中序、後序和層序，它們是解決幾乎所有二叉樹問題的基礎。
- **BST操作**：高效的查找、插入和複雜但有規律的刪除操作。

**接下來做什麼？**
理論知識是基礎，但真正的掌握來自於實踐。現在，你可以嘗試解決我們為你準備的實踐題目了：
1.  **驗證二叉搜索樹**：編寫一個函數，判斷一棵給定的樹是否是有效的BST。
2.  **重建二叉樹**：根據前序和中序遍歷結果，重建出原始的二叉樹。
3.  **路徑總和**：尋找是否存在一條從根到葉子的路徑，其上所有節點值的和等於給定目標。

在你的編程環境中開始挑戰吧！祝你好運！